"""–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help."""
from telegram import Update
from telegram.ext import ContextTypes
from app.core.database import AsyncSessionLocal
from app.services.user_service import UserService
import logging

logger = logging.getLogger(__name__)


async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª."""
    user = update.effective_user
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    async with AsyncSessionLocal() as db:
        service = UserService(db)
        existing_user = await service.get_by_telegram_id(user.id)
    
    # –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã (–¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–º)
    base_commands = (
        "üìã **–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**\n\n"
        "`/start` - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è\n"
        "`/help` - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É\n"
        "`/delete_me` - –£–¥–∞–ª–∏—Ç—å —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç\n"
        "`/cancel` - –û—Ç–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é –æ–ø–µ—Ä–∞—Ü–∏—é\n"
    )
    
    if existing_user:
        # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–æ —Ä–æ–ª–∏
        role = existing_user.role.value
        
        if role == "photographer":
            help_text = (
                f"{base_commands}\n"
                "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n"
                "üì∏ **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–æ–≤:**\n\n"
                "**–¢–µ–∫—É—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**\n"
                "‚Ä¢ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–º\n"
                "‚Ä¢ –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞\n\n"
                "**–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:**\n"
                "‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ (–∑–∞–≥—Ä—É–∑–∫–∞, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π)\n"
                "‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è (–¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞—Ç—ã, –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã, –≤—ã—Ö–æ–¥–Ω—ã–µ)\n"
                "‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–∞–º–∏ —É—Å–ª—É–≥ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, —Ü–µ–Ω—ã)\n"
                "‚Ä¢ –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–æ–Ω—è–º–∏ (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, –æ—Ç–º–µ–Ω–∞, –ø–µ—Ä–µ–Ω–æ—Å)\n"
                "‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –±–∞–∑–æ–π (–∏—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤, –∫–æ–Ω—Ç–∞–∫—Ç—ã)\n"
                "‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ø–æ—Å–æ–±–æ–≤ –æ–ø–ª–∞—Ç—ã (–æ–Ω–ª–∞–π–Ω-–ø–ª–∞—Ç–µ–∂–∏, –Ω–∞–ª–∏—á–Ω—ã–µ, —Ä–µ–∫–≤–∏–∑–∏—Ç—ã)\n"
                "‚Ä¢ –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–µ—Ä–µ–¥–∞—á–∞ –≥–æ—Ç–æ–≤—ã—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∫–ª–∏–µ–Ω—Ç–∞–º\n"
                "‚Ä¢ –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏\n"
                "‚Ä¢ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–∞–Ω–∞–ª–æ–º/–≥—Ä—É–ø–ø–æ–π –≤ Telegram\n"
                "‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\n\n"
                "**–í –±—É–¥—É—â–µ–º:**\n"
                "‚Ä¢ –û–ø—Ä–æ—Å–Ω–∏–∫–∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤\n"
                "‚Ä¢ –ú–∏–Ω–∏-—Å–µ—Å—Å–∏–∏ (–º–∞—Å—Å–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)\n"
                "‚Ä¢ Email/SMS —Ä–∞—Å—Å—ã–ª–∫–∏\n"
                "‚Ä¢ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞\n"
                "‚Ä¢ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–æ—Ü—Å–µ—Ç—è–º–∏\n"
                "‚Ä¢ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏\n"
            )
        else:  # client
            help_text = (
                f"{base_commands}\n"
                "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n"
                "üë§ **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤:**\n\n"
                "**–¢–µ–∫—É—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**\n"
                "‚Ä¢ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–º\n"
                "‚Ä¢ –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞\n\n"
                "**–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:**\n"
                "‚Ä¢ –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–æ–≤ (–≥–∞–ª–µ—Ä–µ—è, –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä)\n"
                "‚Ä¢ –ó–∞–ø–∏—Å—å –Ω–∞ —Å—ä–µ–º–∫—É —á–µ—Ä–µ–∑ –∫–∞–ª–µ–Ω–¥–∞—Ä—å (–≤—ã–±–æ—Ä –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏)\n"
                "‚Ä¢ –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö –±—Ä–æ–Ω–µ–π (—Å—Ç–∞—Ç—É—Å—ã, –¥–µ—Ç–∞–ª–∏, –∏—Å—Ç–æ—Ä–∏—è)\n"
                "‚Ä¢ –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–∞–∫–µ—Ç–æ–≤ —É—Å–ª—É–≥ –∏ —Ü–µ–Ω\n"
                "‚Ä¢ –û–ø–ª–∞—Ç–∞ –æ–Ω–ª–∞–π–Ω –∏–ª–∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤\n"
                "‚Ä¢ –ü–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Å—Ç–∞—Ç—É—Å–µ –∑–∞–∫–∞–∑–∞\n"
                "‚Ä¢ –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤—ã—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π\n"
                "‚Ä¢ –ë—ã—Å—Ç—Ä–∞—è —Å–≤—è–∑—å —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–æ–º —á–µ—Ä–µ–∑ Telegram\n"
                "‚Ä¢ –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–∫–∞–∑–æ–≤\n\n"
                "**–í –±—É–¥—É—â–µ–º:**\n"
                "‚Ä¢ –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø—Ä–æ—Å–Ω–∏–∫–æ–≤ –ø–µ—Ä–µ–¥ —Å—ä–µ–º–∫–æ–π\n"
                "‚Ä¢ –ó–∞–ø–∏—Å—å –Ω–∞ –º–∏–Ω–∏-—Å–µ—Å—Å–∏–∏\n"
                "‚Ä¢ –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–æ–∫ –æ—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–æ–≤\n"
                "‚Ä¢ –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–æ–≤ (–ø–æ–∏—Å–∫ –∏ –≤—ã–±–æ—Ä)\n"
                "‚Ä¢ –ó–∞–∫–∞–∑ –ø–µ—á–∞—Ç–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π\n"
            )
    else:
        # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
        help_text = (
            f"{base_commands}\n"
            "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n"
            "‚ÑπÔ∏è **–û –±–æ—Ç–µ BrashLens:**\n\n"
            "BrashLens - —ç—Ç–æ –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ñ–æ—Ç–æ—Å—ä–µ–º–æ–∫.\n\n"
            "**–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã:**\n"
            "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start` –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–∏:\n"
            "‚Ä¢ üì∏ –§–æ—Ç–æ–≥—Ä–∞—Ñ - –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–≤–æ–∏–º —Ñ–æ—Ç–æ–±–∏–∑–Ω–µ—Å–æ–º\n"
            "‚Ä¢ üë§ –ö–ª–∏–µ–Ω—Ç - –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞ —Å—ä–µ–º–∫–∏ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π\n\n"
            "**–ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏** –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–º—É —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—É:\n"
            "‚Ä¢ –§–æ—Ç–æ–≥—Ä–∞—Ñ—ã —Å–º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ, –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º, –±—Ä–æ–Ω—è–º–∏\n"
            "‚Ä¢ –ö–ª–∏–µ–Ω—Ç—ã —Å–º–æ–≥—É—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ —Å—ä–µ–º–∫–∏ –∏ –ø–æ–ª—É—á–∞—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏\n"
        )
    
    await update.message.reply_text(help_text, parse_mode="Markdown")
    logger.info(f"User {user.id} requested help")
